<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eMenu Tokyo - 東京旅行助手</title>
    <!-- 引入 Vue.js -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Google 字體 -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- 引入 Font Awesome 圖標 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-blue: #2563eb;
            --dark-blue: #1e40af;
            --light-blue: #dbeafe;
            --accent-blue: #3b82f6;
            --danger-red: #ef4444;
            --success-green: #10b981;
            --warning-orange: #f59e0b;
        }
        
        * {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
        }
        
        body {
            background-color: #f8fafc;
            color: #1e293b;
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            position: relative;
        }
        
        /* 卡片樣式 */
        .card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(30, 64, 175, 0.08);
            position: relative;
            overflow: hidden;
        }
        
        .card-header {
            border-bottom: 1px solid #e2e8f0;
            padding: 16px 20px;
        }
        
        /* 按鈕樣式 */
        .btn-primary {
            background-color: var(--primary-blue);
            color: white;
            border-radius: 8px;
            padding: 10px 16px;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .btn-primary:hover {
            background-color: var(--dark-blue);
        }
        
        .btn-outline {
            border: 1px solid var(--primary-blue);
            color: var(--primary-blue);
            border-radius: 8px;
            padding: 10px 16px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .btn-outline:hover {
            background-color: var(--light-blue);
        }
        
        /* 優先級標籤 */
        .priority-tag {
            border-radius: 6px;
            padding: 4px 10px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .priority-high {
            background-color: #fee2e2;
            color: var(--danger-red);
        }
        
        .priority-medium {
            background-color: #fef3c7;
            color: var(--warning-orange);
        }
        
        .priority-low {
            background-color: #d1fae5;
            color: var(--success-green);
        }
        
        /* 輸入框樣式 */
        .input-field {
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            padding: 10px 14px;
            font-size: 15px;
            transition: all 0.2s;
            width: 100%;
        }
        
        .input-field:focus {
            border-color: var(--primary-blue);
            outline: none;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        /* 底部導航 */
        .nav-bottom {
            background-color: white;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .nav-item {
            padding: 12px 0;
            font-size: 12px;
            color: #64748b;
            transition: all 0.2s;
        }
        
        .nav-item.active {
            color: var(--primary-blue);
        }
        
        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }
        
        /* 航班卡片樣式 */
        .flight-card {
            background-color: var(--light-blue);
            border-radius: 10px;
            padding: 16px;
        }
        
        .flight-time {
            font-size: 20px;
            font-weight: 700;
            color: var(--dark-blue);
        }
        
        /* 天氣卡片 */
        .weather-card {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--dark-blue) 100%);
            color: white;
            border-radius: 12px;
            padding: 20px;
        }
        
        /* 自定義滾動條 */
        ::-webkit-scrollbar {
            width: 5px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 5px;
        }
        
        /* 動畫效果 */
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.3s;
        }
        
        .fade-enter, .fade-leave-to {
            opacity: 0;
        }
        
        /* 進度條 */
        .progress-bar {
            height: 6px;
            border-radius: 3px;
            background-color: #e2e8f0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--primary-blue);
            transition: width 0.5s;
        }
        
        /* 彈出層 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 16px;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        /* 響應式調整 */
        @media (max-width: 480px) {
            body {
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div id="app" class="min-h-screen pb-20">
        <!-- 頂部標題欄 -->
        <header class="px-5 py-6">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h1 class="text-2xl font-bold text-gray-900">eMenu Tokyo</h1>
                    <p class="text-gray-600 text-sm">東京4日3夜之旅 • 11月16-19日</p>
                </div>
                <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center">
                    <i class="fas fa-plane text-blue-600"></i>
                </div>
            </div>
            
            <!-- 航班簡要資訊 -->
            <div class="flight-card mb-6">
                <div class="flex justify-between items-center mb-2">
                    <div class="text-sm font-medium text-gray-700">去程航班 • 隨心飛</div>
                    <div class="text-xs font-medium px-2 py-1 bg-blue-500 text-white rounded-full">已確認</div>
                </div>
                <div class="flex justify-between items-center">
                    <div class="text-center">
                        <div class="flight-time">10:50</div>
                        <div class="text-xs text-gray-600 mt-1">HKG</div>
                    </div>
                    <div class="text-center">
                        <div class="text-sm text-gray-700">4h 5m</div>
                        <div class="text-xs text-gray-500 mt-1">U0870</div>
                    </div>
                    <div class="text-center">
                        <div class="flight-time">15:55</div>
                        <div class="text-xs text-gray-600 mt-1">NRT</div>
                    </div>
                </div>
            </div>
        </header>

        <!-- 主內容區域 -->
        <main class="px-5">
            <!-- 行程表頁面 -->
            <div v-if="activeTab === 'schedule'" class="space-y-6">
                <!-- 行前清單卡片 -->
                <div class="card">
                    <div class="card-header">
                        <div class="flex justify-between items-center">
                            <h2 class="text-lg font-bold text-gray-900">行前清單</h2>
                            <button @click="showAddChecklistModal = true" class="btn-primary py-2 px-4 text-sm">
                                <i class="fas fa-plus mr-1"></i>新增
                            </button>
                        </div>
                    </div>
                    
                    <div class="p-5">
                        <div v-if="preTripChecklist.length === 0" class="text-center py-8">
                            <i class="fas fa-clipboard-list text-4xl text-gray-300 mb-3"></i>
                            <p class="text-gray-500">還沒有行前準備事項</p>
                        </div>
                        
                        <div v-else class="space-y-4">
                            <div v-for="(item, index) in preTripChecklist" :key="index" class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                                <div class="flex items-center mr-3 mt-1">
                                    <input 
                                        type="checkbox" 
                                        v-model="item.completed"
                                        class="w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                                    >
                                </div>
                                <div class="flex-grow">
                                    <div :class="['font-medium', item.completed ? 'line-through text-gray-500' : '']">
                                        {{ item.name }}
                                    </div>
                                </div>
                                <!-- 只顯示一個優先級標籤 -->
                                <div :class="['priority-tag', `priority-${item.priority}`]">
                                    {{ getPriorityText(item.priority) }}
                                </div>
                                <button @click="deleteChecklistItem(index)" class="ml-3 text-gray-400 hover:text-red-500">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 4日行程安排卡片 -->
                <div class="card">
                    <div class="card-header">
                        <div class="flex justify-between items-center">
                            <h2 class="text-lg font-bold text-gray-900">行程安排</h2>
                            <button @click="showAddScheduleItemModal = true" class="btn-outline py-2 px-4 text-sm">
                                <i class="fas fa-plus mr-1"></i>新增活動
                            </button>
                        </div>
                    </div>
                    
                    <div class="p-5">
                        <!-- 日期選擇 -->
                        <div class="flex mb-6 overflow-x-auto pb-2">
                            <div 
                                v-for="day in tripDays" 
                                :key="day.id"
                                @click="selectedDay = day.id"
                                :class="['flex-shrink-0 flex flex-col items-center px-4 py-2 rounded-lg mr-2 cursor-pointer', selectedDay === day.id ? 'bg-blue-100 text-blue-700' : 'bg-gray-100 text-gray-700']"
                            >
                                <div class="font-bold text-lg">{{ day.date }}</div>
                                <div class="text-sm">{{ day.day }}</div>
                                <div class="text-xs mt-1">{{ day.area }}</div>
                            </div>
                        </div>
                        
                        <!-- 當日行程 -->
                        <div v-if="selectedDaySchedule">
                            <div v-if="selectedDaySchedule.items.length === 0" class="text-center py-8 text-gray-500">
                                <i class="fas fa-calendar-day text-3xl mb-3"></i>
                                <p>這一天還沒有安排行程</p>
                            </div>
                            
                            <div v-else class="space-y-4">
                                <div v-for="(item, index) in selectedDaySchedule.items" :key="index" class="p-4 border border-gray-200 rounded-lg bg-gray-50">
                                    <div class="flex justify-between items-start">
                                        <div class="flex-grow">
                                            <div class="flex items-center mb-2">
                                                <div class="font-bold text-blue-700 text-lg mr-3">{{ item.time }}</div>
                                                <div class="font-medium text-gray-900">{{ item.title }}</div>
                                            </div>
                                            <div class="text-sm text-gray-600 mb-1">
                                                <i class="fas fa-map-marker-alt mr-1"></i>{{ item.location }}
                                            </div>
                                            <div v-if="item.note" class="text-sm text-gray-600">
                                                <i class="fas fa-info-circle mr-1"></i>{{ item.note }}
                                            </div>
                                        </div>
                                        <div class="flex space-x-2">
                                            <button @click="editScheduleItem(selectedDay, index)" class="text-blue-600 hover:text-blue-800">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button @click="deleteScheduleItem(selectedDay, index)" class="text-red-500 hover:text-red-700">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 地圖頁面 -->
            <div v-if="activeTab === 'map'" class="space-y-6">
                <div class="card">
                    <div class="card-header">
                        <h2 class="text-lg font-bold text-gray-900">東京地圖</h2>
                    </div>
                    
                    <div class="p-5">
                        <div class="mb-4">
                            <div class="flex items-center mb-3">
                                <i class="fas fa-search text-blue-600 mr-2"></i>
                                <input 
                                    type="text" 
                                    v-model="searchLocation" 
                                    placeholder="搜尋東京地點..." 
                                    class="input-field"
                                >
                            </div>
                            
                            <div class="grid grid-cols-2 gap-3 mb-4">
                                <div class="flex items-center">
                                    <i class="fas fa-map-pin text-blue-600 mr-2"></i>
                                    <span class="font-medium">起點：</span>
                                </div>
                                <input type="text" v-model="startLocation" placeholder="例如：池袋駅" class="input-field">
                                
                                <div class="flex items-center">
                                    <i class="fas fa-flag text-blue-600 mr-2"></i>
                                    <span class="font-medium">終點：</span>
                                </div>
                                <input type="text" v-model="endLocation" placeholder="例如：新宿駅" class="input-field">
                            </div>
                            
                            <button @click="openGoogleMaps" class="btn-primary w-full py-3">
                                <i class="fas fa-directions mr-2"></i>開始導航
                            </button>
                        </div>
                        
                        <!-- 地圖熱點區域 -->
                        <div class="mt-6">
                            <h3 class="font-bold text-gray-900 mb-3">熱門區域</h3>
                            <div class="grid grid-cols-2 gap-3">
                                <div class="p-3 bg-blue-50 rounded-lg text-center">
                                    <i class="fas fa-shopping-bag text-blue-600 text-lg mb-1"></i>
                                    <div class="font-medium text-gray-900">澀谷</div>
                                    <div class="text-xs text-gray-600">購物中心</div>
                                </div>
                                <div class="p-3 bg-blue-50 rounded-lg text-center">
                                    <i class="fas fa-torii-gate text-blue-600 text-lg mb-1"></i>
                                    <div class="font-medium text-gray-900">淺草</div>
                                    <div class="text-xs text-gray-600">傳統寺廟</div>
                                </div>
                                <div class="p-3 bg-blue-50 rounded-lg text-center">
                                    <i class="fas fa-tower-observation text-blue-600 text-lg mb-1"></i>
                                    <div class="font-medium text-gray-900">東京鐵塔</div>
                                    <div class="text-xs text-gray-600">觀景地標</div>
                                </div>
                                <div class="p-3 bg-blue-50 rounded-lg text-center">
                                    <i class="fas fa-utensils text-blue-600 text-lg mb-1"></i>
                                    <div class="font-medium text-gray-900">新宿</div>
                                    <div class="text-xs text-gray-600">美食天堂</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 記帳頁面 -->
            <div v-if="activeTab === 'budget'" class="space-y-6">
                <div class="card">
                    <div class="card-header">
                        <h2 class="text-lg font-bold text-gray-900">旅費管理</h2>
                    </div>
                    
                    <div class="p-5">
                        <!-- 預算設置 -->
                        <div class="mb-6 p-4 bg-blue-50 rounded-lg">
                            <h3 class="font-bold text-gray-900 mb-2">預算設置</h3>
                            <div class="flex items-center space-x-3">
                                <div class="flex-grow">
                                    <input 
                                        type="number" 
                                        v-model="budget" 
                                        placeholder="輸入總預算（日圓）" 
                                        class="input-field"
                                        @change="saveBudget"
                                    >
                                </div>
                                <span class="font-medium text-gray-700">¥</span>
                            </div>
                            <div class="mt-2 text-sm text-gray-600">
                                您還可以花費 <span class="font-bold text-blue-700">¥{{ remainingBudget.toLocaleString() }}</span>
                            </div>
                            
                            <!-- 預算進度條 -->
                            <div class="mt-4">
                                <div class="flex justify-between text-sm text-gray-700 mb-1">
                                    <span>預算使用情況</span>
                                    <span>{{ budgetUsedPercentage }}%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" :style="{ width: budgetUsedPercentage + '%' }"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 支出類別篩選 -->
                        <div class="flex mb-4 overflow-x-auto pb-2">
                            <button 
                                v-for="category in expenseCategories" 
                                :key="category.id"
                                @click="selectedExpenseCategory = category.id"
                                :class="['px-4 py-2 rounded-full mr-2 whitespace-nowrap', selectedExpenseCategory === category.id ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700']"
                            >
                                {{ category.name }}
                            </button>
                        </div>
                        
                        <!-- 支出記錄 -->
                        <div v-if="filteredExpenses.length === 0" class="text-center py-8 text-gray-500">
                            <i class="fas fa-receipt text-3xl mb-3"></i>
                            <p>沒有相關的支出紀錄</p>
                        </div>
                        
                        <div v-else class="space-y-4">
                            <div v-for="(expense, index) in filteredExpenses" :key="index" class="p-4 border border-gray-200 rounded-lg">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <div class="font-medium text-gray-900">{{ expense.description }}</div>
                                        <div class="text-sm text-gray-600">{{ expense.category }} • {{ expense.date }}</div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-bold text-gray-900">¥{{ expense.amount.toLocaleString() }}</div>
                                        <div class="text-xs text-gray-500">{{ expense.paymentMethod }}</div>
                                    </div>
                                </div>
                                <div class="flex justify-end mt-3">
                                    <button @click="deleteExpense(index)" class="text-red-500 hover:text-red-700 text-sm">
                                        <i class="fas fa-trash mr-1"></i>刪除
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 添加支出按鈕 -->
                        <button @click="showAddExpenseModal = true" class="btn-primary w-full mt-6 py-3">
                            <i class="fas fa-plus mr-2"></i>記一筆
                        </button>
                    </div>
                </div>
            </div>

            <!-- 購物清單頁面 -->
            <div v-if="activeTab === 'shopping'" class="space-y-6">
                <div class="card">
                    <div class="card-header">
                        <div class="flex justify-between items-center">
                            <h2 class="text-lg font-bold text-gray-900">購物清單</h2>
                            <button @click="showAddShoppingItemModal = true" class="btn-primary py-2 px-4 text-sm">
                                <i class="fas fa-plus mr-1"></i>新增商品
                            </button>
                        </div>
                    </div>
                    
                    <div class="p-5">
                        <div v-if="shoppingList.length === 0" class="text-center py-8 text-gray-500">
                            <i class="fas fa-shopping-bag text-3xl mb-3"></i>
                            <p>購物清單是空的</p>
                        </div>
                        
                        <div v-else class="space-y-4">
                            <div v-for="(item, index) in shoppingList" :key="index" class="p-4 border border-gray-200 rounded-lg">
                                <div class="flex justify-between items-start">
                                    <div class="flex-grow">
                                        <div class="font-bold text-gray-900 text-lg mb-1">{{ item.name }}</div>
                                        <div class="text-sm text-gray-600 mb-2">{{ item.store }}</div>
                                        <div class="text-sm text-gray-600 flex items-center">
                                            <i class="fas fa-map-marker-alt mr-1"></i>{{ item.location }}
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-bold text-gray-900 text-xl">¥{{ item.price.toLocaleString() }}</div>
                                        <div class="text-xs text-gray-500 mt-1">
                                            <span v-if="item.purchased" class="text-green-600">
                                                <i class="fas fa-check mr-1"></i>已購買
                                            </span>
                                            <span v-else class="text-orange-500">
                                                <i class="fas fa-clock mr-1"></i>待購買
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="flex justify-between items-center mt-4">
                                    <div class="flex items-center">
                                        <input 
                                            type="checkbox" 
                                            v-model="item.purchased"
                                            class="w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                                            id="purchased-checkbox"
                                        >
                                        <label for="purchased-checkbox" class="ml-2 text-sm text-gray-700">已購買</label>
                                    </div>
                                    <div class="flex space-x-2">
                                        <button @click="editShoppingItem(index)" class="text-blue-600 hover:text-blue-800">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button @click="deleteShoppingItem(index)" class="text-red-500 hover:text-red-700">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 資訊頁面 -->
            <div v-if="activeTab === 'info'" class="space-y-6">
                <div class="weather-card">
                    <div class="flex justify-between items-center mb-4">
                        <div>
                            <div class="text-lg font-bold">東京天氣</div>
                            <div class="text-3xl font-bold mt-1">{{ currentWeather.temp }}°C</div>
                            <div class="text-sm mt-1">{{ currentWeather.condition }}</div>
                        </div>
                        <i :class="currentWeather.icon" class="text-5xl"></i>
                    </div>
                    <div class="grid grid-cols-3 gap-4 mt-4">
                        <div class="text-center">
                            <div class="text-sm">濕度</div>
                            <div class="font-bold">{{ currentWeather.humidity }}%</div>
                        </div>
                        <div class="text-center">
                            <div class="text-sm">風速</div>
                            <div class="font-bold">{{ currentWeather.windSpeed }} km/h</div>
                        </div>
                        <div class="text-center">
                            <div class="text-sm">體感</div>
                            <div class="font-bold">{{ currentWeather.feelsLike }}°C</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2 class="text-lg font-bold text-gray-900">旅行資訊</h2>
                    </div>
                    
                    <div class="p-5">
                        <!-- 匯率資訊 -->
                        <div class="mb-6">
                            <h3 class="font-bold text-gray-900 mb-3">匯率（今日）</h3>
                            <div class="grid grid-cols-2 gap-3">
                                <div class="p-3 border border-gray-200 rounded-lg text-center">
                                    <div class="text-sm text-gray-600">港幣 HKD</div>
                                    <div class="font-bold text-gray-900">1 HKD ≈ {{ exchangeRates.hkd }} JPY</div>
                                </div>
                                <div class="p-3 border border-gray-200 rounded-lg text-center">
                                    <div class="text-sm text-gray-600">新台幣 TWD</div>
                                    <div class="font-bold text-gray-900">1 TWD ≈ {{ exchangeRates.twd }} JPY</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 實用資訊 -->
                        <div>
                            <h3 class="font-bold text-gray-900 mb-3">實用資訊</h3>
                            <div class="space-y-3">
                                <div class="p-3 border border-gray-200 rounded-lg">
                                    <div class="flex items-center">
                                        <i class="fas fa-train text-blue-600 text-lg mr-3"></i>
                                        <div class="font-medium text-gray-900">東京地鐵</div>
                                    </div>
                                    <div class="text-sm text-gray-600 mt-1">地鐵24/48/72小時通票可在指定時間內無限次乘坐。</div>
                                </div>
                                <div class="p-3 border border-gray-200 rounded-lg">
                                    <div class="flex items-center">
                                        <i class="fas fa-wifi text-blue-600 text-lg mr-3"></i>
                                        <div class="font-medium text-gray-900">免費Wi-Fi</div>
                                    </div>
                                    <div class="text-sm text-gray-600 mt-1">東京設有「Japan Free Wi-Fi」熱點，需註冊使用。</div>
                                </div>
                                <div class="p-3 border border-gray-200 rounded-lg">
                                    <div class="flex items-center">
                                        <i class="fas fa-shopping-cart text-blue-600 text-lg mr-3"></i>
                                        <div class="font-medium text-gray-900">免稅購物</div>
                                    </div>
                                    <div class="text-sm text-gray-600 mt-1">購物滿5,000日圓（不含稅）可辦理免稅手續。</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- 底部導航 -->
        <nav class="nav-bottom fixed bottom-0 left-0 right-0 max-w-480 mx-auto">
            <div class="flex justify-around">
                <div 
                    v-for="tab in tabs" 
                    :key="tab.id"
                    @click="activeTab = tab.id"
                    :class="['nav-item flex flex-col items-center cursor-pointer', activeTab === tab.id ? 'active' : '']"
                >
                    <i :class="[tab.icon, 'nav-icon']"></i>
                    <span>{{ tab.name }}</span>
                </div>
            </div>
        </nav>

        <!-- 新增行前清單項目模態框 -->
        <div v-if="showAddChecklistModal" class="modal-overlay">
            <div class="modal-content">
                <div class="p-6">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">新增行前項目</h3>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">項目名稱</label>
                        <input 
                            type="text" 
                            v-model="newChecklistItem.name" 
                            placeholder="例如：購買旅遊保險" 
                            class="input-field"
                        >
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-gray-700 mb-2">優先級</label>
                        <div class="flex space-x-3">
                            <button 
                                v-for="priority in priorityOptions" 
                                :key="priority.id"
                                @click="newChecklistItem.priority = priority.id"
                                :class="['px-4 py-2 rounded-lg', newChecklistItem.priority === priority.id ? priority.class : 'bg-gray-200 text-gray-700']"
                            >
                                {{ priority.name }}
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex space-x-3">
                        <button @click="showAddChecklistModal = false" class="btn-outline flex-grow">取消</button>
                        <button @click="addChecklistItem" class="btn-primary flex-grow">新增</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 新增行程項目模態框 -->
        <div v-if="showAddScheduleItemModal" class="modal-overlay">
            <div class="modal-content">
                <div class="p-6">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">{{ editingScheduleItem ? '編輯行程項目' : '新增行程項目' }}</h3>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">選擇日期</label>
                        <select v-model="newScheduleItem.day" class="input-field">
                            <option v-for="day in tripDays" :value="day.id">{{ day.date }} {{ day.day }} - {{ day.area }}</option>
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">時間</label>
                        <input 
                            type="text" 
                            v-model="newScheduleItem.time" 
                            placeholder="例如：09:00" 
                            class="input-field"
                        >
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">活動名稱</label>
                        <input 
                            type="text" 
                            v-model="newScheduleItem.title" 
                            placeholder="例如：參觀淺草寺" 
                            class="input-field"
                        >
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">地點</label>
                        <input 
                            type="text" 
                            v-model="newScheduleItem.location" 
                            placeholder="例如：淺草寺" 
                            class="input-field"
                        >
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-gray-700 mb-2">備註（可選）</label>
                        <textarea 
                            v-model="newScheduleItem.note" 
                            placeholder="例如：記得購買御守" 
                            class="input-field"
                            rows="3"
                        ></textarea>
                    </div>
                    
                    <div class="flex space-x-3">
                        <button @click="closeScheduleModal" class="btn-outline flex-grow">取消</button>
                        <button @click="saveScheduleItem" class="btn-primary flex-grow">{{ editingScheduleItem ? '更新' : '新增' }}</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 新增支出模態框 -->
        <div v-if="showAddExpenseModal" class="modal-overlay">
            <div class="modal-content">
                <div class="p-6">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">新增支出</h3>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">描述</label>
                        <input 
                            type="text" 
                            v-model="newExpense.description" 
                            placeholder="例如：午餐 - 壽司" 
                            class="input-field"
                        >
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">金額（日圓）</label>
                        <input 
                            type="number" 
                            v-model="newExpense.amount" 
                            placeholder="例如：2500" 
                            class="input-field"
                        >
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">類別</label>
                        <select v-model="newExpense.category" class="input-field">
                            <option v-for="category in expenseCategories" :value="category.id">{{ category.name }}</option>
                        </select>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-gray-700 mb-2">支付方式</label>
                        <div class="flex space-x-3">
                            <button 
                                v-for="method in paymentMethods" 
                                :key="method.id"
                                @click="newExpense.paymentMethod = method.id"
                                :class="['px-4 py-2 rounded-lg', newExpense.paymentMethod === method.id ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700']"
                            >
                                {{ method.name }}
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex space-x-3">
                        <button @click="showAddExpenseModal = false" class="btn-outline flex-grow">取消</button>
                        <button @click="addExpense" class="btn-primary flex-grow">新增</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 新增購物項目模態框 -->
        <div v-if="showAddShoppingItemModal" class="modal-overlay">
            <div class="modal-content">
                <div class="p-6">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">{{ editingShoppingItemIndex !== null ? '編輯購物項目' : '新增購物項目' }}</h3>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">商品名稱</label>
                        <input 
                            type="text" 
                            v-model="newShoppingItem.name" 
                            placeholder="例如：CEZANNE 101號唇膏" 
                            class="input-field"
                        >
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">價格（日圓）</label>
                        <input 
                            type="number" 
                            v-model="newShoppingItem.price" 
                            placeholder="例如：3000" 
                            class="input-field"
                        >
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">商店</label>
                        <input 
                            type="text" 
                            v-model="newShoppingItem.store" 
                            placeholder="例如：松本清藥妝店" 
                            class="input-field"
                        >
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-gray-700 mb-2">地點</label>
                        <input 
                            type="text" 
                            v-model="newShoppingItem.location" 
                            placeholder="例如：澀谷店" 
                            class="input-field"
                        >
                    </div>
                    
                    <div class="flex space-x-3">
                        <button @click="closeShoppingModal" class="btn-outline flex-grow">取消</button>
                        <button @click="saveShoppingItem" class="btn-primary flex-grow">{{ editingShoppingItemIndex !== null ? '更新' : '新增' }}</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;
        
        createApp({
            setup() {
                // 活動頁面
                const activeTab = ref('schedule');
                
                // 底部導航標籤
                const tabs = [
                    { id: 'schedule', name: '行程', icon: 'fas fa-calendar-day' },
                    { id: 'map', name: '地圖', icon: 'fas fa-map' },
                    { id: 'budget', name: '記帳', icon: 'fas fa-receipt' },
                    { id: 'shopping', name: '購物', icon: 'fas fa-shopping-bag' },
                    { id: 'info', name: '資訊', icon: 'fas fa-info-circle' }
                ];
                
                // 行前清單
                const preTripChecklist = ref([
                    { name: '購買旅遊保險', completed: false, priority: 'high' },
                    { name: '買網卡', completed: false, priority: 'high' },
                    { name: '兌換日圓', completed: true, priority: 'medium' },
                    { name: '確認航班資訊', completed: true, priority: 'medium' },
                    { name: '下載旅行App', completed: true, priority: 'low' },
                    { name: '預訂住宿', completed: true, priority: 'high' }
                ]);
                
                // 優先級選項
                const priorityOptions = [
                    { id: 'high', name: '重要', class: 'bg-red-100 text-red-700' },
                    { id: 'medium', name: '中等', class: 'bg-yellow-100 text-yellow-700' },
                    { id: 'low', name: '一般', class: 'bg-green-100 text-green-700' }
                ];
                
                // 新增行前清單項目
                const showAddChecklistModal = ref(false);
                const newChecklistItem = ref({
                    name: '',
                    priority: 'high'
                });
                
                // 4日行程安排
                const tripDays = [
                    { id: 1, date: '11/16', day: '週六', area: '池袋' },
                    { id: 2, date: '11/17', day: '週日', area: '新宿' },
                    { id: 3, date: '11/18', day: '週一', area: '澀谷' },
                    { id: 4, date: '11/19', day: '週二', area: '橫濱' }
                ];
                
                const selectedDay = ref(1);
                
                // 行程項目數據
                const scheduleData = ref({
                    1: {
                        items: [
                            { time: '08:00', title: '早餐', location: '飯店', note: '' },
                            { time: '10:00', title: '池袋太陽城', location: '池袋', note: '購物中心' },
                            { time: '12:30', title: '午餐 - 拉麵', location: '無敵家拉麵', note: '池袋人氣拉麵店' },
                            { time: '14:00', title: '池袋逛街', location: '池袋東口商店街', note: '動漫商品' },
                            { time: '19:00', title: '晚餐', location: '居酒屋', note: '' }
                        ]
                    },
                    2: {
                        items: [
                            { time: '09:00', title: '新宿御苑', location: '新宿', note: '日式庭園' },
                            { time: '12:00', title: '午餐', location: '新宿黃金街', note: '' },
                            { time: '14:00', title: '逛街', location: '新宿伊勢丹', note: '百貨公司' }
                        ]
                    },
                    3: {
                        items: [
                            { time: '10:00', title: '澀谷十字路口', location: '澀谷', note: '世界最繁忙十字路口' },
                            { time: '11:00', title: '忠犬八公像', location: '澀谷站前', note: '拍照留念' },
                            { time: '13:00', title: '午餐', location: '澀谷美食街', note: '' }
                        ]
                    },
                    4: {
                        items: [
                            { time: '09:00', title: '前往橫濱', location: '新宿駅', note: '乘坐JR湘南新宿線' },
                            { time: '10:30', title: '橫濱中華街', location: '橫濱', note: '日本最大中華街' },
                            { time: '12:30', title: '午餐', location: '橫濱中華街', note: '' },
                            { time: '14:00', title: '橫濱紅磚倉庫', location: '橫濱港', note: '購物與歷史建築' },
                            { time: '16:00', title: '前往羽田機場', location: '橫濱駅', note: '乘坐京急線' },
                            { time: '21:00', title: '辦理登機手續', location: '羽田機場', note: '航班U0623' }
                        ]
                    }
                });
                
                // 新增行程項目
                const showAddScheduleItemModal = ref(false);
                const editingScheduleItem = ref(false);
                const newScheduleItem = ref({
                    day: 1,
                    time: '',
                    title: '',
                    location: '',
                    note: ''
                });
                
                // 地圖相關
                const searchLocation = ref('');
                const startLocation = ref('池袋駅');
                const endLocation = ref('新宿駅');
                
                // 記帳相關
                const budget = ref(150000);
                const expenses = ref([
                    { description: '機場午餐', amount: 1200, category: 'food', paymentMethod: 'cash', date: '11/16' },
                    { description: '地鐵一日券', amount: 800, category: 'transport', paymentMethod: 'cash', date: '11/16' },
                    { description: '藥妝購物', amount: 4500, category: 'shopping', paymentMethod: 'credit', date: '11/16' },
                    { description: '晚餐居酒屋', amount: 3200, category: 'food', paymentMethod: 'credit', date: '11/16' },
                    { description: '池袋太陽城門票', amount: 1000, category: 'entertainment', paymentMethod: 'cash', date: '11/16' }
                ]);
                
                const expenseCategories = [
                    { id: 'all', name: '全部' },
                    { id: 'food', name: '餐飲' },
                    { id: 'transport', name: '交通' },
                    { id: 'shopping', name: '購物' },
                    { id: 'entertainment', name: '娛樂' },
                    { id: 'accommodation', name: '住宿' },
                    { id: 'other', name: '其他' }
                ];
                
                const selectedExpenseCategory = ref('all');
                
                const paymentMethods = [
                    { id: 'cash', name: '現金' },
                    { id: 'credit', name: '信用卡' },
                    { id: 'debit', name: '扣賬卡' }
                ];
                
                // 新增支出
                const showAddExpenseModal = ref(false);
                const newExpense = ref({
                    description: '',
                    amount: null,
                    category: 'food',
                    paymentMethod: 'cash',
                    date: ''
                });
                
                // 購物清單
                const shoppingList = ref([
                    { name: 'CEZANNE 101號唇膏', price: 3000, store: '松本清藥妝店', location: '澀谷店', purchased: false },
                    { name: 'SK-II 護膚精華', price: 12000, store: '伊勢丹百貨', location: '新宿店', purchased: true },
                    { name: '白色戀人巧克力', price: 1500, store: '機場免稅店', location: '成田機場', purchased: false },
                    { name: '日本抹茶粉', price: 800, store: '淺草商店街', location: '淺草', purchased: false }
                ]);
                
                // 新增購物項目
                const showAddShoppingItemModal = ref(false);
                const editingShoppingItemIndex = ref(null);
                const newShoppingItem = ref({
                    name: '',
                    price: null,
                    store: '',
                    location: ''
                });
                
                // 天氣資訊
                const currentWeather = ref({
                    temp: 12,
                    condition: '多雲',
                    humidity: 65,
                    windSpeed: 8,
                    feelsLike: 10,
                    icon: 'fas fa-cloud'
                });
                
                // 匯率資訊
                const exchangeRates = ref({
                    hkd: 18.5,
                    twd: 4.3
                });
                
                // 計算屬性
                const selectedDaySchedule = computed(() => {
                    return scheduleData.value[selectedDay.value];
                });
                
                const filteredExpenses = computed(() => {
                    if (selectedExpenseCategory.value === 'all') {
                        return expenses.value;
                    }
                    return expenses.value.filter(expense => expense.category === selectedExpenseCategory.value);
                });
                
                const totalExpenses = computed(() => {
                    return expenses.value.reduce((total, expense) => total + expense.amount, 0);
                });
                
                const remainingBudget = computed(() => {
                    return budget.value - totalExpenses.value;
                });
                
                const budgetUsedPercentage = computed(() => {
                    if (budget.value <= 0) return 0;
                    return Math.min(100, Math.round((totalExpenses.value / budget.value) * 100));
                });
                
                // 方法
                const getPriorityText = (priority) => {
                    switch(priority) {
                        case 'high': return '重要';
                        case 'medium': return '中等';
                        case 'low': return '一般';
                        default: return '';
                    }
                };
                
                const addChecklistItem = () => {
                    if (!newChecklistItem.value.name.trim()) return;
                    
                    preTripChecklist.value.push({
                        name: newChecklistItem.value.name,
                        completed: false,
                        priority: newChecklistItem.value.priority
                    });
                    
                    newChecklistItem.value.name = '';
                    newChecklistItem.value.priority = 'high';
                    showAddChecklistModal.value = false;
                    
                    saveToLocalStorage();
                };
                
                const deleteChecklistItem = (index) => {
                    preTripChecklist.value.splice(index, 1);
                    saveToLocalStorage();
                };
                
                const openGoogleMaps = () => {
                    const start = startLocation.value || '東京';
                    const end = endLocation.value || '東京';
                    const url = `https://www.google.com/maps/dir/${encodeURIComponent(start)}/${encodeURIComponent(end)}`;
                    window.open(url, '_blank');
                };
                
                const showNavigation = (location) => {
                    const url = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(location + ' 東京')}`;
                    window.open(url, '_blank');
                };
                
                // 行程項目編輯方法
                const saveScheduleItem = () => {
                    if (!newScheduleItem.value.time || !newScheduleItem.value.title || !newScheduleItem.value.location) {
                        alert('請填寫時間、活動名稱和地點');
                        return;
                    }
                    
                    const day = newScheduleItem.value.day;
                    
                    if (editingScheduleItem.value) {
                        // 更新現有項目
                        const index = scheduleData.value[day].items.findIndex(item => 
                            item.time === newScheduleItem.value.originalTime && 
                            item.title === newScheduleItem.value.originalTitle
                        );
                        
                        if (index !== -1) {
                            scheduleData.value[day].items[index] = {
                                time: newScheduleItem.value.time,
                                title: newScheduleItem.value.title,
                                location: newScheduleItem.value.location,
                                note: newScheduleItem.value.note
                            };
                        }
                    } else {
                        // 新增項目
                        if (!scheduleData.value[day]) {
                            scheduleData.value[day] = { items: [] };
                        }
                        
                        scheduleData.value[day].items.push({
                            time: newScheduleItem.value.time,
                            title: newScheduleItem.value.title,
                            location: newScheduleItem.value.location,
                            note: newScheduleItem.value.note
                        });
                        
                        // 按時間排序
                        scheduleData.value[day].items.sort((a, b) => {
                            return a.time.localeCompare(b.time);
                        });
                    }
                    
                    closeScheduleModal();
                    saveToLocalStorage();
                };
                
                const editScheduleItem = (day, index) => {
                    const item = scheduleData.value[day].items[index];
                    newScheduleItem.value = {
                        day: day,
                        time: item.time,
                        title: item.title,
                        location: item.location,
                        note: item.note,
                        originalTime: item.time,
                        originalTitle: item.title
                    };
                    editingScheduleItem.value = true;
                    showAddScheduleItemModal.value = true;
                };
                
                const deleteScheduleItem = (day, index) => {
                    if (confirm('確定要刪除這個行程項目嗎？')) {
                        scheduleData.value[day].items.splice(index, 1);
                        saveToLocalStorage();
                    }
                };
                
                const closeScheduleModal = () => {
                    showAddScheduleItemModal.value = false;
                    editingScheduleItem.value = false;
                    newScheduleItem.value = {
                        day: selectedDay.value,
                        time: '',
                        title: '',
                        location: '',
                        note: ''
                    };
                };
                
                // 支出管理方法
                const saveBudget = () => {
                    if (budget.value < 0) {
                        budget.value = 0;
                    }
                    saveToLocalStorage();
                };
                
                const addExpense = () => {
                    if (!newExpense.value.description || !newExpense.value.amount) {
                        alert('請填寫描述和金額');
                        return;
                    }
                    
                    const today = new Date();
                    const dateStr = `${today.getMonth()+1}/${today.getDate()}`;
                    
                    expenses.value.push({
                        description: newExpense.value.description,
                        amount: parseInt(newExpense.value.amount),
                        category: newExpense.value.category,
                        paymentMethod: newExpense.value.paymentMethod,
                        date: dateStr
                    });
                    
                    newExpense.value = {
                        description: '',
                        amount: null,
                        category: 'food',
                        paymentMethod: 'cash',
                        date: ''
                    };
                    
                    showAddExpenseModal.value = false;
                    saveToLocalStorage();
                };
                
                const deleteExpense = (index) => {
                    if (confirm('確定要刪除這筆支出嗎？')) {
                        expenses.value.splice(index, 1);
                        saveToLocalStorage();
                    }
                };
                
                // 購物清單方法
                const saveShoppingItem = () => {
                    if (!newShoppingItem.value.name || !newShoppingItem.value.price) {
                        alert('請填寫商品名稱和價格');
                        return;
                    }
                    
                    if (editingShoppingItemIndex.value !== null) {
                        // 更新現有項目
                        shoppingList.value[editingShoppingItemIndex.value] = {
                            name: newShoppingItem.value.name,
                            price: parseInt(newShoppingItem.value.price),
                            store: newShoppingItem.value.store,
                            location: newShoppingItem.value.location,
                            purchased: false
                        };
                    } else {
                        // 新增項目
                        shoppingList.value.push({
                            name: newShoppingItem.value.name,
                            price: parseInt(newShoppingItem.value.price),
                            store: newShoppingItem.value.store,
                            location: newShoppingItem.value.location,
                            purchased: false
                        });
                    }
                    
                    closeShoppingModal();
                    saveToLocalStorage();
                };
                
                const editShoppingItem = (index) => {
                    const item = shoppingList.value[index];
                    newShoppingItem.value = {
                        name: item.name,
                        price: item.price,
                        store: item.store,
                        location: item.location
                    };
                    editingShoppingItemIndex.value = index;
                    showAddShoppingItemModal.value = true;
                };
                
                const deleteShoppingItem = (index) => {
                    if (confirm('確定要刪除這個購物項目嗎？')) {
                        shoppingList.value.splice(index, 1);
                        saveToLocalStorage();
                    }
                };
                
                const closeShoppingModal = () => {
                    showAddShoppingItemModal.value = false;
                    editingShoppingItemIndex.value = null;
                    newShoppingItem.value = {
                        name: '',
                        price: null,
                        store: '',
                        location: ''
                    };
                };
                
                // 本地儲存
                const saveToLocalStorage = () => {
                    const data = {
                        preTripChecklist: preTripChecklist.value,
                        scheduleData: scheduleData.value,
                        budget: budget.value,
                        expenses: expenses.value,
                        shoppingList: shoppingList.value
                    };
                    localStorage.setItem('tokyoTripData', JSON.stringify(data));
                };
                
                const loadFromLocalStorage = () => {
                    const savedData = localStorage.getItem('tokyoTripData');
                    if (savedData) {
                        try {
                            const data = JSON.parse(savedData);
                            if (data.preTripChecklist) preTripChecklist.value = data.preTripChecklist;
                            if (data.scheduleData) scheduleData.value = data.scheduleData;
                            if (data.budget) budget.value = data.budget;
                            if (data.expenses) expenses.value = data.expenses;
                            if (data.shoppingList) shoppingList.value = data.shoppingList;
                        } catch (e) {
                            console.error('載入本地儲存失敗', e);
                        }
                    }
                };
                
                // 初始化
                onMounted(() => {
                    loadFromLocalStorage();
                    
                    // 設置今日日期為新增支出的預設日期
                    const today = new Date();
                    newExpense.value.date = `${today.getMonth()+1}/${today.getDate()}`;
                });
                
                return {
                    // 狀態變量
                    activeTab,
                    tabs,
                    preTripChecklist,
                    priorityOptions,
                    showAddChecklistModal,
                    newChecklistItem,
                    tripDays,
                    selectedDay,
                    scheduleData,
                    selectedDaySchedule,
                    showAddScheduleItemModal,
                    editingScheduleItem,
                    newScheduleItem,
                    searchLocation,
                    startLocation,
                    endLocation,
                    budget,
                    expenses,
                    expenseCategories,
                    selectedExpenseCategory,
                    paymentMethods,
                    showAddExpenseModal,
                    newExpense,
                    shoppingList,
                    showAddShoppingItemModal,
                    editingShoppingItemIndex,
                    newShoppingItem,
                    currentWeather,
                    exchangeRates,
                    
                    // 計算屬性
                    filteredExpenses,
                    totalExpenses,
                    remainingBudget,
                    budgetUsedPercentage,
                    
                    // 方法
                    getPriorityText,
                    addChecklistItem,
                    deleteChecklistItem,
                    openGoogleMaps,
                    showNavigation,
                    saveScheduleItem,
                    editScheduleItem,
                    deleteScheduleItem,
                    closeScheduleModal,
                    saveBudget,
                    addExpense,
                    deleteExpense,
                    saveShoppingItem,
                    editShoppingItem,
                    deleteShoppingItem,
                    closeShoppingModal
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
